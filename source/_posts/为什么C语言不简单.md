---
title: 为什么C语言不简单
date: 2016-01-15 19:37:21
tags:
categories:
  - 编程
---

很多人都喜欢把C语言推荐给初学者，原因就是C语言语法简单。但是C语言若是用于开发之中，却是最复杂的语言。

## 底层的 == 好的？

C语言提供了对底层的操作，比如指针。但是C语言跟C++最大的不同就是，C语言避不开指针，而C++和用STL和智能指针库完全避开它。也即是说，其它语言的指针只是个类型，C语言的指针就是指针。我一向认为，初学者过早接触指针是个大忌。初学者需要的是做出各种好玩的应用，以此来产生即时反馈，而不是深入研究计算机系统，因为后者只会消磨掉他们的信心。初学者就应该专注于代码逻辑，并且屏蔽掉和底层打交道的一切事物。这么做个比喻吧，如果你刚学化学的时候，就给你讲元素周期律和VSEPR模型，你会感兴趣吗？<!--more-->

暴露底层从另外一个角度来说也是有害的，这涉及到手动管理堆中内存。计算机讲究的是一个权衡，你可以说这种方式执行效率高，但是大多数情况下，过度追求执行效率而忽视开发效率是不对的。手动管理内存是高级程序员的事情，初级程序员就应该完全交给语言所带的特性来管理内存，否则，你的程序三天出一个空指针异常，五天出一个内存泄漏，这谁受得了？所以c语言无论从哪点来说，都不适合拿来入门。

还有一种看法是，只有c语言能接触到栈和堆的模型。我很负责任的告诉你，所有非脚本的编译语言，比如c++和swift，以及托管语言，比如c#和java，都能接触到栈和堆的模型，而且由于有了自动内存管理机制，后者使用堆的频率要远远高于C。脚本语言也有自己的变量容器模型，比如php的zval。这个锅不应该由编程语言来背，而是应该由国产的垃圾教材来背。也可以看出来，c语言的堆栈模型不是放之于四海皆准的，如果拿它去套在其它语言上，可能就行不通。可有些人非要拿它当作学习其他编程语言的基础，真是可笑。

## 简单的代价

C语言不提供一些通用组件的高级封装和抽象。比如哈希表，你用的时候完全就得自己造一个，或者上网搜搜看有没现成的代码。这就对开发者很不友好了。由于C语言标准库里面没有这个东西，学的时候完全不会提及，这就导致很多人甚至都不知道有这么个东西，遇到问题的时候就只能干瞪眼了。C语言仅仅支持的容器是原生数组，字符串是用原生字符数组实现的，于是对字符串的处理就非常非常弱。你要是想写个字符串拼接的代码，java里要一行，c语言要好几行。这也就是c语言“简单”带来的代价。

C语言的简单恰恰是省略掉了OO的原生支持换来的。我上面为什么说是原生支持，是因为C语言还是可以用组合的方式实现OO的，比如继承用组合实现，虚函数用指针函数成员来实现，等等。在OO的方面，C语言实现起来要比C++难得多。C++的一个关键词，对应到C语言又是几行代码，何谈简单呢？OO好也罢，坏也罢，它是现在业界通用的语言范式，其作用就像自然语言中的英语一样，举足轻重。如果不接触一下这个，以后找工作的时候就很吃亏。但是OO真的复杂吗？这些东西，你如果去翻java的书，顶多花两章介绍，一章是类，一章是接口。其它不那么OO的语言干脆就花一章了，就是告诉你有个class，而这些篇幅也差不多是C语言教程中结构和枚举的篇幅。

C语言的“简单”，就意味着实际开发中，你需要做更多的手动操作来代替编译器。我想上帝是公平的，给了其它语言更多的语言特性，就会同时给他们更高的开发效率。

## 再谈谈标准库

C语言书薄的原因，不是因为没有OO那些东西，而是标准库中缺少一些现代化的组件，这些东西可都在posix里。离开posix api谈C语言，就是耍流氓。通用的组件或设施，到了c语言这边，一个都不会少，因为现代的程序运行环境和需求，你离了这些东西，就根本写不出什么来。现代编程语言的五大库（字符串、容器、io、线程、网络），c语言就坑掉两个了。至于后面那两个，C语言开发者不得不去使用posix api，然后再去解决api不兼容问题。以C语言标准库的德性，离了posix就是半残。而如果要了解posix，就得看《apue》。你如果跟我说C语言简单，看完《apue》那一大厚本书，再跟我说简单吧。

## 不是后记的后记

我们学一门编程语言并不是要拿来应付考试，而是要实际做东西的。像C语言这种没有容器、没有string、没有模板、没有异常、没有RAII，所有轮子自己造，毫无现代编程语言特性的语言，真正用的时候复杂到爆。抱歉，我没有时间去研究每个特性或者类在C语言里怎么实现，我还是喜欢用更简短的代码来表达我的逻辑。

哪里简单呢？写玩具程序简单吗？